!function(e){var t={};function n(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=e,n.c=t,n.d=function(e,t,s){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(s,i,function(t){return e[t]}.bind(null,i));return s},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=7)}([function(e,t){e.exports=window.wp.element},function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var s=t[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(e,s.key,s)}}e.exports=function(e,t,s){return t&&n(e.prototype,t),s&&n(e,s),e},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,n){var s=n(8);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&s(e,t)},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},e.exports.default=e.exports,e.exports.__esModule=!0,n(t)}e.exports=n,e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,n){var s=n(9).default,i=n(1);e.exports=function(e,t){return!t||"object"!==s(t)&&"function"!=typeof t?i(e):t},e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t,n){"use strict";n.r(t);var s=n(1),i=n.n(s),a=n(2),o=n.n(a),r=n(3),l=n.n(r),c=n(4),u=n.n(c),p=n(6),h=n.n(p),d=n(5),b=n.n(d),g=n(0);function m(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,s=b()(e);if(t){var i=b()(this).constructor;n=Reflect.construct(s,arguments,i)}else n=s.apply(this,arguments);return h()(this,n)}}var __=wp.i18n.__,f=wp.editPost,y=f.PluginSidebar,w=f.PluginSidebarMoreMenuItem,v=wp.components,k=v.PanelBody,O=(v.TextControl,wp.element),P=O.Component,C=O.Fragment,_=wp.data.withSelect,E=(wp.compose.compose,wp.plugins.registerPlugin),j=(0,wp.element.createElement)("img",{width:20,height:20,src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABgAAAAYCAYAAADgdz34AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyhpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNi1jMTExIDc5LjE1ODMyNSwgMjAxNS8wOS8xMC0wMToxMDoyMCAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIDIwMTUgKE1hY2ludG9zaCkiIHhtcE1NOkluc3RhbmNlSUQ9InhtcC5paWQ6MUYxNjlGNkY3NjAxMTFFNjkyRkZBRTlDQTMwREJDQzUiIHhtcE1NOkRvY3VtZW50SUQ9InhtcC5kaWQ6MUYxNjlGNzA3NjAxMTFFNjkyRkZBRTlDQTMwREJDQzUiPiA8eG1wTU06RGVyaXZlZEZyb20gc3RSZWY6aW5zdGFuY2VJRD0ieG1wLmlpZDoxRjE2OUY2RDc2MDExMUU2OTJGRkFFOUNBMzBEQkNDNSIgc3RSZWY6ZG9jdW1lbnRJRD0ieG1wLmRpZDoxRjE2OUY2RTc2MDExMUU2OTJGRkFFOUNBMzBEQkNDNSIvPiA8L3JkZjpEZXNjcmlwdGlvbj4gPC9yZGY6UkRGPiA8L3g6eG1wbWV0YT4gPD94cGFja2V0IGVuZD0iciI/Pq7th6IAAAP8SURBVHjalFbbT5tlHH56grKWnicw5ijdAjNGg5CxbPGIM7qx7cIlxihxd7oLr/wHlpgsu/FWjbdeeOWFwUQixmW6GGbKpDKcgqhj7AA90CM9t/j8Xr+vKZW08Gue0O/jfZ/n/R3fGg73+dHE2ogzxEvEU4SPMBJxYon4kZjUnnc0QxOBD4j3iX40txjxKfEhUdqNwJPE58SwWmAwoFQqoVQsolqtwmgyoa2tDWazGVtbW/X7FokJYrb+pbGB/DliTsiNRiPyuRw2YjEY+HF7fejqOQCHw4FcNotoOKyEZZ1mg0SQeKWe0Fz3PUBck3cGCepGDE6XG8dOnIQ/cBgutwcmnrpcLiEaieB2KIRfgj+jnd54fT5UKhWdZ1oTW2oUmFTkDEl8Y4OkAbx69jwOPn5IhaO76zH0dHfB7Xaj3WpFMpXGt1Pf4KOrV7Fy9x/4+wMUL+tcX2sitRxckkQJeTIRRy9J35h4B06nEz6vFyPDQ/D3HYKJ8W+0UGgeFyfexh93fqeIv94TKZCPdYH7RK/EVBJ54c23MHD0CXXiU2MvorPT3rSM7q7cw8ljo8xZFr79+xUH7SFxUDL0gpDLm81MBkcGj6qY2237cOrl1uRi4t3lK1dQYojy+Zz++gAxJgJj8iQlJyHo6e1VZTgy/Aw67a3JdXvt9GmcePZ5hjihSlszJTAg38QtIXY4nHC5nAgE+rEX28fED42MwGazq/LVS1cEOvQn8UKEfCy7Dmv7ngTyhbyKv4coFAr6a58IqNqShimyW1OpJOx2G/ZqaZatgRxWelKt1ippq9aGErdKpYzVlRWeprBngYeP1lApVxSMhhptZNuosDGpfy0t4vr31+rruaWtcWys3n9AL5LIpFOwWCz6v37bJmC1dnBBGqG5ORRK5V2RS1hv3gyqA/29/CcS8Q20tdfyN10/Kv5rdYZq9Pgoq6J1ktPpDG78NIP1cASRSBi/3rrFsWJRHKyYZS6Z2SZQZOzFi7Pj402Js9kcVu6tYmHhDuLJJDY3M5ia/Arh9Udwe7z6GL/cOOwQjUVxZvwchoaeRjyRxPztBczOztKzCr06rhovzW6PcYTH2VClYkkNuh++m8Yyc+fkINTIZ4gv/icgwy3HeXLp3fcQDM5ifW1dzReLxYwjA4Po4wiRNSazCSkKPFhdxfLiIkOVgsvjUZVIgRSpXq+/0b7k3wvyINlPcGMkGoHD3qlq2sLulubLMgxym0kIhahYLCgPbDabGt/ayRPabJvf6cJRLS4bBI2mSCgk1SKTRkaCsdOoiDVy+QFwUYZr443Wvat6JImcXC6f+tGinfYT4rOdtsnqKSkMfWS0MIOGtEZ8g7jebMO/AgwANr2XXAf8LaoAAAAASUVORK5CYII="}),T="components-button is-button is-default is-primary is-large wpdc-button",x="components-button is-button is-default is-primary is-large wpdc-button active",S=Object(g.createElement)("svg",{className:"components-panel__arrow",width:"24px",height:"24px",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",role:"img","aria-hidden":"true",focusable:"false"},Object(g.createElement)("g",null,Object(g.createElement)("path",{fill:"none",d:"M0,0h24v24H0V0z"})),Object(g.createElement)("g",null,Object(g.createElement)("path",{d:"M7.41,8.59L12,13.17l4.59-4.58L18,10l-6,6l-6-6L7.41,8.59z"}))),N=Object(g.createElement)("svg",{className:"components-panel__arrow",width:"24px",height:"24px",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",role:"img","aria-hidden":"true",focusable:"false"},Object(g.createElement)("g",null,Object(g.createElement)("path",{fill:"none",d:"M0,0h24v24H0V0z"})),Object(g.createElement)("g",null,Object(g.createElement)("path",{d:"M12,8l-6,6l1.41,1.41L12,10.83l4.59,4.58L18,14L12,8z"}))),D=function(e){u()(n,e);var t=m(n);function n(e){return o()(this,n),t.call(this,e)}return l()(n,[{key:"render",value:function(){return Object(g.createElement)("div",null,Object(g.createElement)(M,{forcePublish:this.props.forcePublish,published:this.props.published}),Object(g.createElement)(U,{statusMessage:this.props.statusMessage}),Object(g.createElement)(A,{publishingError:this.props.publishingError}),Object(g.createElement)(R,{discoursePermalink:this.props.discoursePermalink}))}}]),n}(P),M=function(e){u()(n,e);var t=m(n);function n(e){return o()(this,n),t.call(this,e)}return l()(n,[{key:"render",value:function(){return this.props.forcePublish&&!this.props.published?Object(g.createElement)("p",{className:"wpdc-force-publish-message"},__("The Force Publish option is enabled for your site. All posts published on WordPress will be automatically published to Discourse.","wp-discourse")):""}}]),n}(P),U=function(e){u()(n,e);var t=m(n);function n(e){return o()(this,n),t.call(this,e)}return l()(n,[{key:"render",value:function(){var e=this.props.statusMessage;return e?Object(g.createElement)("div",{className:"wpdc-publishing-response success"},e):""}}]),n}(P),A=function(e){u()(n,e);var t=m(n);function n(e){return o()(this,n),t.call(this,e)}return l()(n,[{key:"render",value:function(){var e=this.props.publishingError;if(e){var t;switch(e){case"deleted_topic":t=__("Your post could not be published to Discourse. The associated Discourse topic may have been deleted. Unlink the post so that it can be published again.","wp-discourse");break;case"Not Found":t=__("Your post could not be updated on Discourse. The associated Discourse topic may have been deleted. Unlink the post so that it can be published again.","wp-discourse");break;case"queued_topic":t=__("Your post has been added to the Discourse approval queue. When it has been approved, you will need to link it to Discourse byselecting the 'Link to Existing Topic' option.","wp-discourse");break;case"Unprocessable Entity":t=__("Your post could not be published to Discourse. There may be an existing Discourse topic that is using its permalink. Try linking the post with that topic.","wp-discourse");break;case"Forbidden":t=__("Your post could not be published to Discourse. Check that your Discourse Username is set correctly on your WordPress profile page.","wp-discourse");break;default:t=e}return Object(g.createElement)("div",{className:"wpdc-publishing-response error"},t)}return""}}]),n}(P),R=function(e){u()(n,e);var t=m(n);function n(e){return o()(this,n),t.call(this,e)}return l()(n,[{key:"render",value:function(){if(this.props.discoursePermalink){var e=encodeURI(this.props.discoursePermalink),t=Object(g.createElement)("a",{href:e,className:"wpdc-permalink-link",target:"_blank",rel:"noreferrer noopener"},e);return Object(g.createElement)("div",{className:"wpdc-permalink"},__("Your post is linked with","wp-discourse")," ",t)}return""}}]),n}(P),I=function(e){u()(n,e);var t=m(n);function n(e){var s;return o()(this,n),(s=t.call(this,e)).handleChange=s.handleChange.bind(i()(s)),s}return l()(n,[{key:"handleChange",value:function(e){this.props.handlePublishMethodChange(e.target.value)}},{key:"render",value:function(){return Object(g.createElement)("div",{className:"wpdc-publishing-options"},Object(g.createElement)("h2",{className:"wpdc-sidebar-title"},__("Publishing Options","wp-discourse")),Object(g.createElement)("label",null,Object(g.createElement)("input",{type:"radio",name:"wpdc_publish_options",value:"publish_post",checked:"publish_post"===this.props.publishingMethod,onChange:this.handleChange}),__("New Topic","wp-discourse")),Object(g.createElement)("br",null),Object(g.createElement)("label",null,Object(g.createElement)("input",{type:"radio",name:"wpdc_publish_options",value:"link_post",checked:"link_post"===this.props.publishingMethod,onChange:this.handleChange}),__("Link to Existing Topic","wp-discourse")),Object(g.createElement)("hr",{className:"wpdc-sidebar-hr"}))}}]),n}(P),G=function(e){u()(n,e);var t=m(n);function n(e){var s;return o()(this,n),(s=t.call(this,e)).handleToBePublishedChange=s.handleToBePublishedChange.bind(i()(s)),s.handlePublishChange=s.handlePublishChange.bind(i()(s)),s}return l()(n,[{key:"handleToBePublishedChange",value:function(e){this.props.handleToBePublishedChange(e.target.checked)}},{key:"handlePublishChange",value:function(e){this.props.handlePublishChange(e)}},{key:"render",value:function(){var e=this.props.publishToDiscourse;return"publish"===this.props.postStatus?Object(g.createElement)("div",{className:"wpdc-component-panel-body"},Object(g.createElement)("h2",{className:"wpdc-sidebar-title"},__("Publish to Discourse","wp-discourse")),Object(g.createElement)("button",{className:this.props.busy?x:T,onClick:this.handlePublishChange},__("Publish to Discourse","wp-discourse"))):Object(g.createElement)("div",{className:"wpdc-component-panel-body"},Object(g.createElement)("h2",{className:"wpdc-sidebar-title"},__("Publish to Discourse","wp-discourse")),Object(g.createElement)("div",{className:"wpdc-publish-topic"},Object(g.createElement)("input",{type:"checkBox",className:"wpdc-publish-topic-checkbox",checked:e,onChange:this.handleToBePublishedChange}),__("Publish","wp-discourse"),Object(g.createElement)("p",{className:"wpdc-info"},__("Automatically publish the post to Discourse when it is published on WordPress.","wp-discourse"))))}}]),n}(P),Y=function(e){u()(n,e);var t=m(n);function n(e){var s;return o()(this,n),(s=t.call(this,e)).handleChange=s.handleChange.bind(i()(s)),s}return l()(n,[{key:"handleChange",value:function(e){this.props.handleCategoryChange(e.target.value)}},{key:"render",value:function(){var e=this;if(this.props.discourseCategories){var t=Object.values(this.props.discourseCategories).map((function(t){return Object(g.createElement)("option",{value:t.id,selected:parseInt(e.props.category_id,10)===parseInt(t.id,10)},t.name)}));return Object(g.createElement)("div",{className:"wpdc-category-select wpdc-component-panel-body"},Object(g.createElement)("h2",{className:"wpdc-sidebar-title"},__("Category","wp-discourse")),Object(g.createElement)("select",{onChange:this.handleChange,className:"widefat"},t),Object(g.createElement)("hr",{className:"wpdc-sidebar-hr"}))}return this.props.categoryError?Object(g.createElement)("div",{className:"wpdc-api-error error"},__("There was an error returning the category list from Discourse.","discourse-integration")):null}}]),n}(P),Z=function(e){u()(n,e);var t=m(n);function n(e){var s;return o()(this,n),(s=t.call(this,e)).state={isBusy:!1,topicUrl:null},s.handleChange=s.handleChange.bind(i()(s)),s.handleClick=s.handleClick.bind(i()(s)),s}return l()(n,[{key:"handleChange",value:function(e){this.setState({topicUrl:e.target.value})}},{key:"handleClick",value:function(e){this.props.handleLinkTopicClick(this.state.topicUrl)}},{key:"render",value:function(){return Object(g.createElement)("div",{className:"wpdc-link-post wpdc-component-panel-body"},Object(g.createElement)("h2",{className:"wpdc-sidebar-title"},__("Topic URL","wp-discourse")),Object(g.createElement)("input",{type:"url",className:"widefat wpdc-topic-url-input",onChange:this.handleChange,value:this.state.topicUrl}),Object(g.createElement)("button",{className:this.props.busy?x:T,onClick:this.handleClick},__("Link With Discourse","wp-discourse")))}}]),n}(P),L=function(e){u()(n,e);var t=m(n);function n(e){var s;return o()(this,n),(s=t.call(this,e)).state={showPanel:!1},s.handleClick=s.handleClick.bind(i()(s)),s.togglePanel=s.togglePanel.bind(i()(s)),s}return l()(n,[{key:"handleClick",value:function(e){this.props.handleUnlinkFromDiscourseChange(e)}},{key:"togglePanel",value:function(){this.setState({showPanel:!this.state.showPanel})}},{key:"render",value:function(){return Object(g.createElement)("div",{className:"wpdc-component-panel-body"},Object(g.createElement)("h2",{className:"wpdc-panel-section-title"},Object(g.createElement)("button",{type:"button","aria-expanded":"false",className:"components-button components-panel__body-toggle",onClick:this.togglePanel},Object(g.createElement)("span",{"aria-hidden":"true"},this.state.showPanel?N:S),__("Unlink From Discourse","wp-discourse"))),Object(g.createElement)("div",{className:this.state.showPanel?"":"hidden"},Object(g.createElement)("p",{className:"wpdc-info"},__("Unlinking the post from Discourse will remove all Discourse metadata from the post.","wp-discourse")),Object(g.createElement)("button",{className:this.props.busy?x:T,onClick:this.handleClick},__("Unlink Post","wp-discourse"))))}}]),n}(P),B=function(e){u()(n,e);var t=m(n);function n(e){var s;return o()(this,n),(s=t.call(this,e)).state={showPanel:!1},s.handleClick=s.handleClick.bind(i()(s)),s.togglePanel=s.togglePanel.bind(i()(s)),s}return l()(n,[{key:"togglePanel",value:function(){this.setState({showPanel:!this.state.showPanel})}},{key:"handleClick",value:function(e){this.props.handleUpdateChange(e)}},{key:"render",value:function(){return Object(g.createElement)("div",{className:"wpdc-component-panel-body"},Object(g.createElement)("h2",{className:"wpdc-panel-section-title"},Object(g.createElement)("button",{type:"button","aria-expanded":"false",className:"components-button components-panel__body-toggle",onClick:this.togglePanel},Object(g.createElement)("span",{"aria-hidden":"true"},this.state.showPanel?N:S),__("Update Discourse Topic","wp-discourse"))),Object(g.createElement)("div",{className:this.state.showPanel?"":"hidden"},Object(g.createElement)("p",{className:"wpdc-info"},__("Update the Discourse topic to the lastest saved version of the post.","wp-discourse")),Object(g.createElement)("button",{className:this.props.busy?x:T,onClick:this.handleClick},__("Update Topic","wp-discourse"))))}}]),n}(P),z=function(e){u()(n,e);var t=m(n);function n(e){var s;return o()(this,n),(s=t.call(this,e)).state={chosenTags:s.props.tags,inputContent:"",inputLength:1,maxTagsExceeded:!1},s.handleKeyPress=s.handleKeyPress.bind(i()(s)),s.handleChange=s.handleChange.bind(i()(s)),s.handleClick=s.handleClick.bind(i()(s)),s.focusInput=s.focusInput.bind(i()(s)),s}return l()(n,[{key:"focusInput",value:function(e){this.tagInput.focus()}},{key:"handleChange",value:function(e){var t=e.target.value;this.setState({inputContent:","===t?"":t,inputLength:0===t.length?1:t.length})}},{key:"handleKeyPress",value:function(e){var t=this,s=e.key,i=e.target.value,a=new RegExp("^[a-zA-Z0-9-_ ]+$");if("Enter"===s||","===s){var o=this.state.chosenTags;if(o.length>=this.props.maxTags)return this.setState({maxTagsExceeded:!0,inputContent:""}),null;a.test(i)?(o.push(i.trim().replace(/ /g,"-")),o=n.sanitizeArray(o),this.setState({chosenTags:o,inputContent:""},(function(){t.props.handleTagChange(o)}))):this.setState({inputContent:""})}}},{key:"handleClick",value:function(e){var t=this,n=this.state.chosenTags,s=n.indexOf(e);s>-1&&(n.splice(s,1),this.setState({chosenTags:n,maxTagsExceeded:!1},(function(){t.props.handleTagChange(n)})))}},{key:"render",value:function(){var e=this;if(this.props.allowTags){var t=this.state.maxTagsExceeded?__("You have exceeded the maximum number of allowed tags for your site. Remove a tag to add more.","wp-discourse"):"",s=n.sanitizeArray(this.state.chosenTags);return s=s.map((function(t,n){return Object(g.createElement)("span",{className:"components-form-token-field__token",key:t},Object(g.createElement)("span",{className:"components-form-token-field__token-text"},Object(g.createElement)("span",{className:"screen-reader-text"},t),Object(g.createElement)("span",{"aria-hidden":"true"},t)),Object(g.createElement)("button",{type:"button","aria-label":"Remove Tag",className:"components-button components-icon-button components-form-token-field__remove-token",onClick:e.handleClick.bind(e,t),key:t},Object(g.createElement)("svg",{"aria-hidden":"true",role:"img",focusable:"false",className:"dashicon dashicons-dismiss",xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 20 20"},Object(g.createElement)("path",{d:"M10 2c4.42 0 8 3.58 8 8s-3.58 8-8 8-8-3.58-8-8 3.58-8 8-8zm5 11l-3-3 3-3-2-2-3 3-3-3-2 2 3 3-3 3 2 2 3-3 3 3z"}))))})),Object(g.createElement)("div",{className:"wpdc-component-panel-body"},Object(g.createElement)("h2",{className:"wpdc-sidebar-title"},__("Tags","wp-discourse")),Object(g.createElement)("div",{className:"components-form-token-field__input-container",onClick:this.focusInput},s,Object(g.createElement)("input",{type:"text",size:this.state.inputLength,className:"components-form-token-field__input",onChange:this.handleChange,onKeyPress:this.handleKeyPress,value:this.state.inputContent,ref:function(t){e.tagInput=t}})),Object(g.createElement)("div",{className:this.state.maxTagsExceeded?"wpdc-info":""},t),Object(g.createElement)("hr",{className:"wpdc-sidebar-hr"}))}return null}}],[{key:"sanitizeArray",value:function(e){return e.sort().reduce((function(e,t){var n=e.length;return 0!==n&&e[n-1]===t||""===t.trim()||e.push(t),e}),[])}}]),n}(P),W=function(e){u()(n,e);var t=m(n);function n(e){var s;return o()(this,n),(s=t.call(this,e)).state={pinTopic:s.props.pinTopic,pinUntil:s.props.pinUntil},s.handleUpdateDate=s.handleUpdateDate.bind(i()(s)),s.handleToBePinnedChange=s.handleToBePinnedChange.bind(i()(s)),s}return l()(n,[{key:"handleUpdateDate",value:function(e){this.setState({pinUntil:e.target.value}),this.props.handlePinChange(this.state.pinTopic,e.target.value)}},{key:"handleToBePinnedChange",value:function(e){this.setState({pinTopic:e.target.checked}),this.props.handlePinChange(e.target.checked,this.state.pinUntil)}},{key:"render",value:function(){return Object(g.createElement)("div",{className:"wpdc-component-panel-body"},Object(g.createElement)("h2",{className:"wpdc-sidebar-title"},__("Pin Topic","wp-discourse")),Object(g.createElement)("label",null,Object(g.createElement)("input",{type:"checkbox",onChange:this.handleToBePinnedChange,checked:this.state.pinTopic}),__("Pin Discourse Topic","wp-discourse")),Object(g.createElement)("br",null),Object(g.createElement)("label",{className:"wpdc-pin-until-input"},__("Pin Until","wp-discourse"),Object(g.createElement)("br",null),Object(g.createElement)("input",{type:"date",className:"widefat",onChange:this.handleUpdateDate,value:this.state.pinUntil})),Object(g.createElement)("hr",{className:"wpdc-sidebar-hr"}))}}]),n}(P),F=function(e){u()(n,e);var t=m(n);function n(e){var s;return o()(this,n),(s=t.call(this,e)).state=s.initializePostState(s.props.post),s.getDiscourseCategories(),s.handleToBePublishedChange=s.handleToBePublishedChange.bind(i()(s)),s.handlePublishChange=s.handlePublishChange.bind(i()(s)),s.handleCategoryChange=s.handleCategoryChange.bind(i()(s)),s.handleTagChange=s.handleTagChange.bind(i()(s)),s.handleUnlinkFromDiscourseChange=s.handleUnlinkFromDiscourseChange.bind(i()(s)),s.handlePublishMethodChange=s.handlePublishMethodChange.bind(i()(s)),s.handleUpdateChange=s.handleUpdateChange.bind(i()(s)),s.handleLinkTopicClick=s.handleLinkTopicClick.bind(i()(s)),s.handlePinChange=s.handlePinChange.bind(i()(s)),s}return l()(n,[{key:"componentDidUpdate",value:function(e){this.isAllowedPostType()&&this.publishedPostHasChanged(e.post,this.props.post)&&this.updatePostState(this.props.post)}},{key:"publishedPostHasChanged",value:function(e,t){return!!(e&&t&&e.meta&&t.meta)&&![t.status,e.status].every((function(e){return"publish"!==e}))&&(t.status!==e.status||["discourse_post_id","wpdc_publishing_response","wpdc_publishing_error"].some((function(n){return t.meta[n]!==e.meta[n]})))}},{key:"initializePostState",value:function(e){if(!this.isAllowedPostType())return{};var t={published:!1,postStatus:"",publishingMethod:"publish_post",forcePublish:pluginOptions.forcePublish,publishToDiscourse:pluginOptions.autoPublish,publishPostCategory:pluginOptions.defaultCategory,allowTags:pluginOptions.allowTags,maxTags:pluginOptions.maxTags,topicTags:[],pinTopic:!1,pinUntil:null,discoursePostId:null,discoursePermalink:null,publishingError:null,busyUnlinking:!1,busyUpdating:!1,busyLinking:!1,busyPublishing:!1,statusMessage:null,discourseCategories:null,categoryError:!1};return e&&e.meta&&(t=Object.assign(t,this.buildPostState(e))),t}},{key:"updatePostState",value:function(e){this.setState(this.buildPostState(e))}},{key:"buildPostState",value:function(e){if(!e||!e.meta)return{};var t=e.meta,n="string"==typeof t.wpdc_topic_tags?t.wpdc_topic_tags.split(","):[],s={publishToDiscourse:this.determinePublishToDiscourse(t),published:t.discourse_post_id>0,postStatus:e.status,topicTags:n,pinTopic:t.wpdc_pin_topic>0};return t.publish_post_category>0&&(s.publishPostCategory=t.publish_post_category),t.wpdc_pin_until&&(s.pinUntil=t.wpdc_pin_until),t.discourse_post_id&&(s.discoursePostId=t.discourse_post_id),t.discourse_permalink&&(s.discoursePermalink=t.discourse_permalink),t.wpdc_publishing_error&&(s.publishingError=t.wpdc_publishing_error),s}},{key:"determinePublishToDiscourse",value:function(e){var t=pluginOptions.autoPublish,n=1===parseInt(e.wpdc_auto_publish_overridden,10);return!(["deleted_topic","queued_topic"].includes(e.wpdc_publishing_error)||(!t||n)&&1!==parseInt(e.wpdc_publish_to_discourse,10))}},{key:"getDiscourseCategories",value:function(){var e=this;pluginOptions.pluginUnconfigured||wp.apiRequest({path:"/wp-discourse/v1/get-discourse-categories",method:"GET",data:{get_categories_nonce:pluginOptions.get_categories_nonce,id:this.props.postId}}).then((function(t){e.setState({discourseCategories:t})}),(function(t){e.setState({categoryError:!0})}))}},{key:"isAllowedPostType",value:function(){return pluginOptions.allowedPostTypes.indexOf(this.props.post.type)>=0}},{key:"handlePublishMethodChange",value:function(e){this.setState({publishingMethod:e})}},{key:"handleToBePublishedChange",value:function(e){var t=this;this.setState({publishToDiscourse:e,statusMessage:""},(function(){wp.apiRequest({path:"/wp-discourse/v1/set-publish-meta",method:"POST",data:{set_publish_meta_nonce:pluginOptions.set_publish_meta_nonce,id:t.props.postId,publish_to_discourse:t.state.publishToDiscourse?1:0}}).then((function(e){return null}),(function(e){return null}))}))}},{key:"handleCategoryChange",value:function(e){var t=this;this.setState({publishPostCategory:e},(function(){wp.apiRequest({path:"/wp-discourse/v1/set-category-meta",method:"POST",data:{set_category_meta_nonce:pluginOptions.set_category_meta_nonce,id:t.props.postId,publish_post_category:e}}).then((function(e){return null}),(function(e){return null}))}))}},{key:"handlePinChange",value:function(e,t){var n=this;this.setState({pinTopic:e,pinUntil:t},(function(){wp.apiRequest({path:"/wp-discourse/v1/set-pin-meta",method:"Post",data:{set_pin_meta_nonce:pluginOptions.set_pin_meta_nonce,id:n.props.postId,wpdc_pin_topic:e?1:0,wpdc_pin_until:t}}).then((function(e){return null}),(function(e){return null}))}))}},{key:"handleTagChange",value:function(e){var t=this;this.setState({topicTags:e},(function(){var n=e.join(",");wp.apiRequest({path:"/wp-discourse/v1/set-tag-meta",method:"POST",data:{set_tag_meta_nonce:pluginOptions.set_tag_meta_nonce,id:t.props.postId,wpdc_topic_tags:n}}).then((function(e){return null}),(function(e){return null}))}))}},{key:"handleLinkTopicClick",value:function(e){var t=this;this.setState({busyLinking:!0,statusMessage:""}),wp.apiRequest({path:"/wp-discourse/v1/link-topic",method:"POST",data:{link_topic_nonce:pluginOptions.link_topic_nonce,id:this.props.postId,topic_url:e}}).then((function(e){return t.setState({busyLinking:!1}),e.discourse_permalink?t.setState({published:!0,discoursePermalink:e.discourse_permalink,publishingError:null}):t.setState({publishingError:__("There has been an error linking your post with Discourse.","wp-discourse")}),null}),(function(e){var n=e.responseJSON&&e.responseJSON.message?e.responseJSON.message:__("There has been an error linking your post with Discourse.","wp-discourse");return t.setState({busyLinking:!1,published:!1,publishingError:n}),null}))}},{key:"handleUnlinkFromDiscourseChange",value:function(e){var t=this;this.setState({busyUnlinking:!0,statusMessage:""}),wp.apiRequest({path:"/wp-discourse/v1/unlink-post",method:"POST",data:{unlink_post_nonce:pluginOptions.unlink_post_nonce,id:this.props.postId}}).then((function(e){return t.setState({busyUnlinking:!1,published:!1,publishingMethod:"link_post",discoursePermalink:null,statusMessage:__("Your post has been unlinked from Discourse.","wp-discourse")}),null}),(function(e){return null}))}},{key:"handlePublishChange",value:function(e){var t=this;this.setState({busyPublishing:!0,statusMessage:""}),wp.apiRequest({path:"/wp-discourse/v1/publish-topic",method:"POST",data:{publish_topic_nonce:pluginOptions.publish_topic_nonce,id:this.props.postId}}).then((function(e){var n="success"===e.publish_response;return t.setState({busyPublishing:!1,published:n,publishingError:n?null:e.publish_response,publishingMethod:e.publish_response="link_post",discoursePermalink:e.discourse_permalink}),null}),(function(e){var n=e.responseJSON&&e.responseJSON.message?e.responseJSON.message:__("There has been an error linking your post with Discourse.","wp-discourse");return t.setState({busyPublishing:!1,published:!1,publishingError:n}),null}))}},{key:"handleUpdateChange",value:function(e){var t=this;this.setState({busyUpdating:!0,statusMessage:""}),wp.apiRequest({path:"/wp-discourse/v1/update-topic",method:"POST",data:{update_topic_nonce:pluginOptions.update_topic_nonce,id:this.props.postId}}).then((function(e){var n,s="success"===e.update_response;return s&&(n=__("The Discourse topic has been updated!","wp-discourse")),t.setState({busyUpdating:!1,statusMessage:n,publishingError:s?null:e.update_response}),null}),(function(e){var n=__("There was an error updating the Discourse topic.","wp-discourse");return t.setState({busyUpdating:!1,statusMessage:n}),null}))}},{key:"render",value:function(){if(this.isAllowedPostType()){var e,t=this.state.published,n=this.state.forcePublish;return e=pluginOptions.pluginUnconfigured?Object(g.createElement)("div",{className:"wpdc-plugin-unconfigured"},__("Before you can publish posts from WordPress to Discourse, you need to configure the plugin's Connection Settings tab.","discourse-integration")):t||n?n?null:Object(g.createElement)("div",{className:"wpdc-published-post"},Object(g.createElement)(B,{published:this.state.published,busy:this.state.busyUpdating,handleUpdateChange:this.handleUpdateChange,forcePublish:this.state.forcePublish}),Object(g.createElement)(L,{published:this.state.published,handleUnlinkFromDiscourseChange:this.handleUnlinkFromDiscourseChange,busy:this.state.busyUnlinking,forcePublish:this.state.forcePublish})):Object(g.createElement)("div",{className:"wpdc-not-published"},Object(g.createElement)(I,{handlePublishMethodChange:this.handlePublishMethodChange,publishingMethod:this.state.publishingMethod}),"publish_post"===this.state.publishingMethod?Object(g.createElement)("div",{className:"wpdc-publish-to-discourse"},Object(g.createElement)(Y,{category_id:this.state.publishPostCategory,handleCategoryChange:this.handleCategoryChange,discourseCategories:this.state.discourseCategories,categoryError:this.state.categoryError}),Object(g.createElement)(z,{handleTagChange:this.handleTagChange,tags:this.state.topicTags,allowTags:this.state.allowTags,maxTags:this.state.maxTags}),Object(g.createElement)(W,{handlePinChange:this.handlePinChange,pinTopic:this.state.pinTopic,pinUntil:this.state.pinUntil}),Object(g.createElement)(G,{postStatus:this.state.postStatus,publishToDiscourse:this.state.publishToDiscourse,handleToBePublishedChange:this.handleToBePublishedChange,handlePublishChange:this.handlePublishChange,busy:this.state.busyPublishing})):Object(g.createElement)("div",{className:"wpdc-link-to-discourse"},Object(g.createElement)(Z,{busy:this.state.busyLinking,handleLinkTopicClick:this.handleLinkTopicClick}))),Object(g.createElement)(C,null,Object(g.createElement)(w,{target:"discourse-sidebar"},__("Discourse","wp-discourse")),Object(g.createElement)(y,{name:"discourse-sidebar",title:__("Discourse","wp-discourse")},Object(g.createElement)(k,null,Object(g.createElement)("div",{className:"wpdc-sidebar"},Object(g.createElement)(D,{published:this.state.published,forcePublish:this.state.forcePublish,publishingError:this.state.publishingError,discoursePermalink:this.state.discoursePermalink,statusMessage:this.state.statusMessage}),e))))}return null}}]),n}(P);E("discourse-sidebar",{icon:j,render:_((function(e,t){t.forceIsSaving;var n=e("core/editor"),s=n.getCurrentPostId,i=n.getCurrentPost;return{postId:s(),post:i()}}))(F)})},function(e,t){function n(t,s){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},e.exports.default=e.exports,e.exports.__esModule=!0,n(t,s)}e.exports=n,e.exports.default=e.exports,e.exports.__esModule=!0},function(e,t){function n(t){return"function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?(e.exports=n=function(e){return typeof e},e.exports.default=e.exports,e.exports.__esModule=!0):(e.exports=n=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.default=e.exports,e.exports.__esModule=!0),n(t)}e.exports=n,e.exports.default=e.exports,e.exports.__esModule=!0}]);